---
layout: post
title:  "关于volatile"
date:   2017-03-28 19:24:25 +0800
categories: jekyll update
---
##关于volatile
关键字volatile与内存模型紧密相关，是现成同步的轻量级实现，主要用于修饰变量。在多线程环境下主要用于及时感知共享变量的修改，并保证其他线程及时得到变量的最新值。  
####内存模型相关概念  
程序运行时，将预算需要的数据从主存复制一份到cpu的高速缓存中，后续的计算以这个复制值为主，计算结束后，再将高速缓存的数据刷新到主存中。  
多线程中，每个线程运行于不同的cpu中，因此每个cpu都有自己的高速缓存。  
######缓存一致性协议   
最出名的是intel的MESI协议，其保证了每个缓存中使用的共享变量的副本是一致的。  
<font  color="red">其思想：</font>当cpu写数据时，若发现操作的变量是共享变量，即在其他cpu中也存在该变量的副本，会发出信号通知其他cpu将该变量的缓存行为置为无效状态。因此，当其他cpu需要读取这个变量是，发现自己的缓存中缓存该变量的缓存行为是无效的，那么他就从内存重新读取。  
####并发的三个概念  
原子性：一个操作或多个操作要么全部执行且执行过程不会被任何因素打断，要么不执行。  
可见性：当多个线程访问一个共享变量是，一个线程修改了变量的值，则其他线程能立即看到修改的值。  <font  color="red">synchronized也可以保持可见性，即每次运行synchronized时都会导致线程工作内存与主存同步，使线程可以取得共享变量的最新值。</font>  
有序性：程序执行的顺序按照代码的先后顺序执行。  
